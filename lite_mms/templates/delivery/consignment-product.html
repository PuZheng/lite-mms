<script type="text/javascript">
    $(function () {
        var products = {{ products|safe }};
        var selected_product_type = $("#product_type").val();
        $.each(products[selected_product_type], function (idx, entry) {
            $("#product").append('<option value="' + entry.id + '">' + entry.name + '</option>');
        });
        var product_id = {{ current.product.id }};
        $("#product").children().filter("option[value=" + product_id + "]").attr("selected", "selected");
        $("#product_type").change(function (ui) {
            var selected_product_type = $("#product_type").val();
            $("#product").empty();
            $.each(products[selected_product_type], function (idx, entry) {
                $("#product").append("<option value=" + entry.id + ">" + entry.name + "</option>");
                $("#product").children().filter("option[value=" + product_id + "]").attr("selected", "selected");
            });
        });
        $("button[type=button]").click(function () {
            $("#view-product-dialog").dialog("close");
        });
        {% if current.consignment.MSSQL_ID or not permissions.CargoClerkPermission.can() %}
            $("input").attr("disabled", true);
            $("select").attr("disabled", true);
        {% endif %}
    });
</script>
<form class="ym-form linearize-form ym-columnar"
      action=""
      method="POST">
    <div class="ym-fbox-select">
        <label for="product_type"><b>产品类型：</b></label>
        <select id="product_type" name="product_type_id">
            {% for pt in product_types %}
                <option value="{{ pt.id }}"
                        {% if pt.id == current.product.product_type_id %}selected="selected"{% endif %}>{{ pt.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="ym-fbox-select">
        <label for="product"><b>产品名称：</b></label>
        <select name="product_id" id="product">
        </select>
    </div>
    {% if not current.consignment.measured_by_weight %}
        <div class="ym-fbox-text"><label for="spec"><b>型号</b></label>
            <input type="text" id="spec" name="spec"
                   value="{{ current.spec }}">
        </div>
        <div class="ym-fbox-text"><label for="type"><b>规格</b></label>
            <input type="text" name="type" id="type"
                   value="{{ current.type }}">
        </div>
        <div class="ym-fbox-text"><label for="quantity"><b>数量</b></label>
            <input type="text" name="quantity" id="quantity"
                   value="{{ current.quantity }}">
        </div>
        <div class="ym-fbox-text"><label for="unit"><b>单位</b></label>
            <input type="text" name="unit" id="unit"
                   value="{{ current.unit }}">
        </div>
    {% endif %}
    <div class="ym-fbox-text">
        <label for="weight"><b>净重(KG)</b></label>
        <input type="number" name="weight" id="weight"
               value="{{ current.weight }}">
    </div>
    <div class="ym-fbox-text">
        <label for="returned_weight"><b>退镀重量(KG)</b></label>
        <input type="number" name="returned_weight" id="returned_weight"
               value="{{ current.returned_weight }}">
    </div>
    <div class="ym-fbox-select">
        <label for="team"><b>生产班组</b></label>
        <select name="team_id" id="team">
            {% for team in team_list %}
                <option value="{{ team.id }}"
                        {% if team.id == current.team_id %}
                        selected="selected"
                        {% endif %} >{{ team.name }}</option>
            {% endfor %}
        </select>
    </div>
    <input type="hidden" name="url" value="{{ url }}">
    <input type="hidden" name="consignment_product_id" value="{{ current.id }}">
    {% if not current.consignment.MSSQL_ID and permissions.CargoClerkPermission.can() %}
        <button class="ym-button ym-save">保存</button>
    {% endif %}
    <button class="ym-button ym-delete" type="button">取消</button>
</form>