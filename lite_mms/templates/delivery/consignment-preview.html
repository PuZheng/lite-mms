<!DOCTYPE HTML>
<html lang="en">
<head>
    <link rel="stylesheet"
          href="{{ url_for("static", filename="css/central.css") }}"/>
    <link type="text/css"
          href="{{ url_for("static", filename="css/custom-theme/jquery-ui-1.10.1.custom.min.css") }}"
          rel="stylesheet">
    <style type="text/css">
        .ym-wrapper {
            max-width: 50em;
        }

        input[type="text"] {
            border: 0;
        }
    </style>
    <script src="{{ url_for("static", filename="js/jquery-1.8.3.min.js") }}"></script>
    <script src="{{ url_for("static", filename="js/jquery-ui-1.10.1.custom.min.js") }}"></script>
    <script src="{{ url_for("static", filename="js/jquery-printarea.js") }}"
            type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            $("button").click(function () {
                        {% if consignment.pay_in_cash == True and consignment.is_paid == false %}
                            alert("未付款");
                            return false;
                        {% else %}
                            $(this).attr("disabled", true);
                            {% if not consignment.MSSQL_ID %}
                                $.post("/delivery/ajax/consignment", {id:{{ consignment.id}}}).error(function (data) {
                                    $("button").attr("disabled", false);
                                    if (confirm(data.responseText + "，继续打印？")) {
                                        $("#printArea").printArea();
                                    }
                                }).success(function(){
                                            $("#printArea").printArea();
                                        });
                            {% else %}
                                $("#printArea").printArea();
                            {% endif %}

                        {% endif %}
                    }
            );
        })
    </script>
    <title>{{ titlename }}</title>
    <meta charset="UTF-8">
</head>
<body>
<div class="ym-wrapper">
    <div class="ym-wbox">
        <div class="ym-form linearize-form ym-columnar" id="printArea">
            <h5 class="float-right">NO. {{ consignment.id }}</h5>
            <table class="bordertable">
                <tr>
                    <th colspan="5"><h4 class="center">金禾域加工发货单</h4></th>
                </tr>
                <tr>
                    <th>发货单号</th>
                    <td colspan="4"><p
                            class="center">{{ consignment.consignment_id }}</p>
                    </td>
                </tr>
                <tr>
                    <th>公司名称</th>
                    <td colspan="4"><p
                            class="center">{{ consignment.customer.name }}</p>
                    </td>
                </tr>
                <tr>
                    <th>车辆车牌号</th>
                    <td colspan="4"><p
                            class="center">{{ consignment.plate }}</p></td>
                </tr>
                <tr>
                    <th>日期</th>
                    <td colspan="4"><p
                            class="center">{{ consignment.create_time.date() }}</p>
                    </td>
                </tr>
                <tr>
                    <th>产品名称</th>
                    {% if consignment.measured_by_weight %}
                        <th colspan="3">净重(KG)</th>
                    {% else %}
                        <th>规格-型号</th>
                        <th>数量</th>
                        <th>净重(KG)</th>
                    {% endif %}
                    <th>生产班组</th>
                </tr>
                {% for product in consignment.product_list %}
                    <tr>
                        <td>{{ product.product.name }}</td>
                        {% if  consignment.measured_by_weight %}
                            <td colspan="3">
                                {{ product.weight }}
                                {% if product.returned_weight %}
                                    (退镀{{ product.returned_weight }}KG)
                                {% endif %}
                            </td>
                        {% else %}
                            <td>{{ product.spec + "-" + product.type }}</td>
                            <td>{{ product.quantity }}({{ product.unit }})</td>
                            <td>
                                {{ product.weight }}
                                {% if product.returned_weight %}
                                    (退镀{{ product.returned_weight }}KG)
                                {% endif %}
                            </td>
                        {% endif %}
                        <td>
                            {{ product.team.name }}
                        </td>
                    </tr>
                {% endfor %}
                <tr>
                    <th>备注：</th>
                    <td colspan="4">{{ consignment.notes or "" }}</td>
                </tr>
                <tr>
                    <td colspan="3">客户签名：</td>
                    <td colspan="2">
                        总重量(KG):{{ consignment.product_list|sum(attribute='weight') }}</td>
                </tr>
            </table>
        </div>
        <div class="ym-fbox-text center"><p>支付类型：</p>
            {% if consignment.pay_in_cash %}现金支付 {% if consignment.is_paid %}
                已支付{% else %}未支付{% endif %}{% else %}月结{% endif %}</div>
        <div class="ym-fbox-button center">
            <button class="ym-button ym-next">{{ _("打印") }}</button>
            <a href="{{ request.args.get("url") or url_for("delivery.session_list") }}"
               class="ym-button ym-delete">{{ _("返回") }}</a>
        </div>
    </div>
</div>
</body>
</html>


